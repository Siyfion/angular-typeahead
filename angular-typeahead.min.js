angular.module("siyfion.sfTypeahead",[]).directive("sfTypeahead",function(){return{restrict:"AC",require:"?ngModel",scope:{options:"=",datasets:"=",suggestionKey:"@"},link:function(e,a,t,n){function i(){if(r)a.typeahead(e.options,e.datasets),r=!1;else{var t=a.val();a.typeahead("destroy"),a.typeahead(e.options,e.datasets),n.$setViewValue(t),a.triggerHandler("typeahead:opened")}}function d(e,a){var t=-1;return angular.forEach(e,function(e,n){angular.equals(a,e)&&(t=n)}),t>=0}function s(a,t,i){e.$apply(function(){var a=angular.isDefined(e.suggestionKey)?t[e.suggestionKey]:t;n.$setViewValue(a)})}var u=e.options||{},o=(angular.isArray(e.datasets)?e.datasets:[e.datasets])||[],r=!0;i(),e.$watch("options",i),angular.isArray(e.datasets)?e.$watchCollection("datasets",i):e.$watch("datasets",i),n.$parsers.push(function(e){if(angular.isObject(n.$modelValue)&&e===a.typeahead("val"))return n.$modelValue;var t=angular.isObject(e);return u.editable===!1?(n.$setValidity("typeahead",t),t?e:void 0):e}),n.$formatters.push(function(t){if(angular.isObject(t)){var i=!1;return $.each(o,function(s,r){function c(r){var c=d(r,t);c?(n.$setViewValue(t),i=!0):n.$setViewValue(u.editable===!1?void 0:t),(i||s===o.length-1)&&setTimeout(function(){e.$apply(function(){a.typeahead("val",y)})},0)}var l=r.source,p=r.displayKey||"value",y=(angular.isFunction(p)?p(t):t[p])||"";return i?!1:y?void l(y,c):void c([])}),""}return null==t&&a.typeahead("val",null),t}),a.bind("typeahead:selected",function(a,t,n){s(a,t,n),e.$emit("typeahead:selected",t,n)}),a.bind("typeahead:autocompleted",function(a,t,n){s(a,t,n),e.$emit("typeahead:autocompleted",t,n)}),a.bind("typeahead:opened",function(){e.$emit("typeahead:opened")}),a.bind("typeahead:closed",function(){e.$emit("typeahead:closed")}),a.bind("typeahead:asyncrequest",function(){e.$emit("typeahead:asyncrequest")}),a.bind("typeahead:asynccancel",function(){e.$emit("typeahead:asynccancel")}),a.bind("typeahead:asyncreceive",function(){e.$emit("typeahead:asyncreceive")}),a.bind("typeahead:render",function(){e.$emit("typeahead:render")}),a.bind("typeahead:cursorchanged",function(a,t,n){e.$emit("typeahead:cursorchanged",a,t,n)})}}});
